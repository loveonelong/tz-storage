{"version":3,"file":"tz-storage.js","sources":["../src/Storage.js"],"sourcesContent":["class Storage {\r\n  constructor() {\r\n    this._namespace = ''\r\n    this._defaultValue = null\r\n    this._isSupported = this._checkSupported\r\n  }\r\n\r\n  /**\r\n   * check supported getter\r\n   * @readonly\r\n   * @memberof Storage\r\n   */\r\n  get _checkSupported() {\r\n    return window.localStorage && (window.localStorage.setItem('tls', 'ls') , window.localStorage.getItem('tls') === 'ls')\r\n  }\r\n\r\n  /**\r\n   * namespace getter\r\n   * @memberof Storage\r\n   * @returns {string}\r\n   */\r\n  get namespace() {\r\n    return this._namespace\r\n  }\r\n\r\n  /**\r\n   * namespace setter\r\n   * @memberof Storage\r\n   */\r\n  set namespace(value) {\r\n    this._namespace = value ? `${value}.` : ''\r\n  }\r\n\r\n  set defaultValue(value) {\r\n    // todo 设置默认值\r\n    this._defaultValue = value\r\n  }\r\n\r\n  /**\r\n   * set localstorage value\r\n   * @param {string} key \r\n   * @param {string} value \r\n   * @param {number} [expire] expire timestamp, pass 0 to disable expire\r\n   * @returns\r\n   * @memberof Storage\r\n   */\r\n  set(key, value, expire = 0) {\r\n    if (!this._isSupported) return false\r\n    key = this._keyHandle(key)\r\n    value = JSON.stringify({ data: value , expire: expire})\r\n    try {\r\n      window.localStorage.setItem(key, value)\r\n      return true\r\n    } catch (e) {\r\n      console.error(e, `Type Error: value is not supported.`)\r\n      return false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * get localstorage value\r\n   * @param {string} key \r\n   * @param {object} options\r\n   * @param {any} options.defaultValue returned when the value is empty\r\n   * @param {string=[\"string\",\"number\",\"boolean\"]} options.type parse type of the value \r\n   */\r\n  get(key, {defaultValue = null, type} = {}) {\r\n    if (!this._isSupported) return defaultValue\r\n    key = this._keyHandle(key)\r\n    let _value = JSON.parse(window.localStorage.getItem(key))\r\n    if (_value === null) return defaultValue\r\n\r\n    let { data, expire } = _value\r\n    \r\n    let now = new Date().getTime()\r\n    if (expire && expire < now) {\r\n      window.localStorage.removeItem(key)\r\n      return defaultValue\r\n    }\r\n    switch (type) {\r\n      case 'string':\r\n        data = `${data}`\r\n        break\r\n      case 'number':\r\n        data = Number(data)\r\n        break\r\n      case 'boolean':\r\n        data = Boolean(data)\r\n        break\r\n      default:\r\n        break\r\n    }\r\n    \r\n    return data === null ? defaultValue : data\r\n  }\r\n\r\n  /**\r\n   * remove the specified localstorage\r\n   * @param {string} key \r\n   */\r\n  remove(key) {\r\n    if (!this._isSupported) return false\r\n    key = this._keyHandle(key)\r\n    window.localStorage.removeItem(key)\r\n    return true\r\n  }\r\n\r\n  _keyHandle(key) {\r\n    return this._namespace + key\r\n  }\r\n}\r\n\r\nexport default new Storage()\r\n"],"names":["Storage","_namespace","_defaultValue","_isSupported","_checkSupported","key","value","expire","_keyHandle","JSON","stringify","data","window","localStorage","setItem","e","console","error","defaultValue","type","_value","parse","getItem","now","Date","getTime","removeItem","Number","Boolean"],"mappings":"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"}