{"version":3,"file":"tz-storage.js","sources":["../src/Storage.js","../src/index.js"],"sourcesContent":["class Storage {\r\n  constructor() {\r\n    this._namespace = ''\r\n    this._defaultValue = null\r\n  }\r\n\r\n  /**\r\n   * check supported getter\r\n   * @readonly\r\n   * @memberof Storage\r\n   */\r\n  get _checkSupported() {\r\n    return window.localStorage && (window.localStorage.setItem('tls', 'ls') , window.localStorage.getItem('tls') === 'ls') ?\r\n    true : false\r\n  }\r\n\r\n  get isSupported() {\r\n    return this._checkSupported\r\n  }\r\n\r\n  /**\r\n   * namespace getter\r\n   * @memberof Storage\r\n   * @returns {string}\r\n   */\r\n  get namespace() {\r\n    return this._namespace\r\n  }\r\n\r\n  /**\r\n   * namespace setter\r\n   * @memberof Storage\r\n   */\r\n  set namespace(value) {\r\n    this._namespace = value ? `${value}.` : ''\r\n  }\r\n\r\n  set defaultValue(value) {\r\n    this._defaultValue = value\r\n  }\r\n\r\n  /**\r\n   * init config\r\n   * @memberof Storage\r\n   */\r\n  config({\r\n    namespace = '',\r\n    defaultValue = null\r\n  } = {}) {\r\n    this.namespace = namespace\r\n    this.defaultValue = defaultValue\r\n  }\r\n\r\n  /**\r\n   * set localstorage value\r\n   * @param {string} key \r\n   * @param {string} value \r\n   * @param {number} [expire] expire timestamp, pass 0 to disable expire\r\n   * @returns\r\n   * @memberof Storage\r\n   */\r\n  set(key, value, expire = 0) {\r\n    if (!this._checkSupported) return false\r\n    key = this._keyHandle(key)\r\n    value = JSON.stringify({ data: value , expire: expire})\r\n    window.localStorage.setItem(key, value)\r\n    return true\r\n  }\r\n\r\n  /**\r\n   * get localstorage value\r\n   * @param {string} key \r\n   * @param {object} options\r\n   * @param {any} options.defaultValue returned when the value is empty\r\n   * @param {string=[\"string\",\"number\",\"boolean\"]} options.type parse type of the value \r\n   */\r\n  get(key, {defaultValue = this._defaultValue, type} = {}) {\r\n    if (!this._checkSupported) return defaultValue\r\n    key = this._keyHandle(key)\r\n    let _value = JSON.parse(window.localStorage.getItem(key))\r\n    if (_value === null) return defaultValue\r\n\r\n    let { data, expire } = _value\r\n    \r\n    let now = new Date().getTime()\r\n    if (expire && expire < now) {\r\n      window.localStorage.removeItem(key)\r\n      return defaultValue\r\n    }\r\n\r\n    try {\r\n      if (type && (['number', 'string', 'boolean'].indexOf(type) < 0)) throw(`Type Error: unsupported type param.`)\r\n    } catch (e) {\r\n      console.error(e)\r\n      return false\r\n    }\r\n      switch (type) {\r\n        case 'string':\r\n          data = `${data}`\r\n          break\r\n        case 'number':\r\n          data = Number(data)\r\n          break\r\n        case 'boolean':\r\n          data = Boolean(data)\r\n          break\r\n        default:\r\n          break\r\n      }\r\n    \r\n    return data === null ? defaultValue : data\r\n  }\r\n\r\n  /**\r\n   * remove the specified localstorage\r\n   * @param {string} key \r\n   */\r\n  remove(key) {\r\n    if (!this._checkSupported) return false\r\n    key = this._keyHandle(key)\r\n    window.localStorage.removeItem(key)\r\n    return true\r\n  }\r\n\r\n  _keyHandle(key) {\r\n    return this._namespace + key\r\n  }\r\n\r\n  create(){\r\n    return new Storage()\r\n  }\r\n}\r\n\r\nexport default Storage\r\n","import Storage from './Storage'\r\n\r\nexport default new Storage()\r\n"],"names":["Storage","_namespace","_defaultValue","namespace","defaultValue","key","value","expire","_checkSupported","_keyHandle","JSON","stringify","data","window","localStorage","setItem","type","_value","parse","getItem","now","Date","getTime","removeItem","indexOf","e","console","error","Number","Boolean"],"mappings":"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"}