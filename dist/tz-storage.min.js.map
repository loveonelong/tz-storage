{"version":3,"file":"tz-storage.min.js","sources":["../src/Storage.js"],"sourcesContent":["class Storage {\r\n  constructor() {\r\n    this._namespace = ''\r\n    this._defaultValue = null\r\n  }\r\n\r\n  /**\r\n   * check supported getter\r\n   * @readonly\r\n   * @memberof Storage\r\n   */\r\n  get _checkSupported() {\r\n    return window.localStorage && (window.localStorage.setItem('tls', 'ls') , window.localStorage.getItem('tls') === 'ls') ?\r\n    true : false\r\n  }\r\n\r\n  get isSupported() {\r\n    return this._checkSupported\r\n  }\r\n\r\n  /**\r\n   * namespace getter\r\n   * @memberof Storage\r\n   * @returns {string}\r\n   */\r\n  get namespace() {\r\n    return this._namespace\r\n  }\r\n\r\n  /**\r\n   * namespace setter\r\n   * @memberof Storage\r\n   */\r\n  set namespace(value) {\r\n    this._namespace = value ? `${value}.` : ''\r\n  }\r\n\r\n  set defaultValue(value) {\r\n    this._defaultValue = value\r\n  }\r\n\r\n  /**\r\n   * init config\r\n   * @memberof Storage\r\n   */\r\n  config({\r\n    namespace = '',\r\n    defaultValue = null\r\n  } = {}) {\r\n    this._namespace = namespace\r\n    this._defaultValue = defaultValue\r\n  }\r\n\r\n  /**\r\n   * set localstorage value\r\n   * @param {string} key \r\n   * @param {string} value \r\n   * @param {number} [expire] expire timestamp, pass 0 to disable expire\r\n   * @returns\r\n   * @memberof Storage\r\n   */\r\n  set(key, value, expire = 0) {\r\n    if (!this._checkSupported) return false\r\n    key = this._keyHandle(key)\r\n    value = JSON.stringify({ data: value , expire: expire})\r\n    window.localStorage.setItem(key, value)\r\n    return true\r\n  }\r\n\r\n  /**\r\n   * get localstorage value\r\n   * @param {string} key \r\n   * @param {object} options\r\n   * @param {any} options.defaultValue returned when the value is empty\r\n   * @param {string=[\"string\",\"number\",\"boolean\"]} options.type parse type of the value \r\n   */\r\n  get(key, {defaultValue = this._defaultValue, type} = {}) {\r\n    if (!this._checkSupported) return defaultValue\r\n    key = this._keyHandle(key)\r\n    let _value = JSON.parse(window.localStorage.getItem(key))\r\n    if (_value === null) return defaultValue\r\n\r\n    let { data, expire } = _value\r\n    \r\n    let now = new Date().getTime()\r\n    if (expire && expire < now) {\r\n      window.localStorage.removeItem(key)\r\n      return defaultValue\r\n    }\r\n\r\n    try {\r\n      if (type && (['number', 'string', 'boolean'].indexOf(type) < 0)) throw(`Type Error: unsupported type param.`)\r\n    } catch (e) {\r\n      console.error(e)\r\n      return false\r\n    }\r\n      switch (type) {\r\n        case 'string':\r\n          data = `${data}`\r\n          break\r\n        case 'number':\r\n          data = Number(data)\r\n          break\r\n        case 'boolean':\r\n          data = Boolean(data)\r\n          break\r\n        default:\r\n          break\r\n      }\r\n    \r\n    return data === null ? defaultValue : data\r\n  }\r\n\r\n  /**\r\n   * remove the specified localstorage\r\n   * @param {string} key \r\n   */\r\n  remove(key) {\r\n    if (!this._checkSupported) return false\r\n    key = this._keyHandle(key)\r\n    window.localStorage.removeItem(key)\r\n    return true\r\n  }\r\n\r\n  _keyHandle(key) {\r\n    return this._namespace + key\r\n  }\r\n}\r\n\r\nexport default new Storage()\r\n"],"names":["_namespace","_defaultValue","namespace","defaultValue","key","value","expire","this","_checkSupported","_keyHandle","JSON","stringify","data","window","localStorage","setItem","type","_value","parse","getItem","now","Date","getTime","removeItem","indexOf","e","console","error"],"mappings":"0WAiIe,uIA/HNA,WAAa,QACbC,cAAgB,0JA6CnB,OAFFC,cACAC,aAAAA,aAAe,YAEVH,sBAHO,UAIPC,cAAgBE,8BAWnBC,EAAKC,OAAOC,yDAAS,UAClBC,KAAKC,kBACVJ,EAAMG,KAAKE,WAAWL,GACtBC,EAAQK,KAAKC,UAAU,CAAEC,KAAMP,EAAQC,OAAQA,IAC/CO,OAAOC,aAAaC,QAAQX,EAAKC,IAC1B,+BAULD,gEAAiD,OAA3CD,aAAAA,aAAeI,KAAKN,gBAAee,IAAAA,SACtCT,KAAKC,gBAAiB,OAAOL,EAClCC,EAAMG,KAAKE,WAAWL,OAClBa,EAASP,KAAKQ,MAAML,OAAOC,aAAaK,QAAQf,OACrC,OAAXa,EAAiB,OAAOd,MAEtBS,EAAiBK,EAAjBL,KAAMN,EAAWW,EAAXX,OAERc,GAAM,IAAIC,MAAOC,aACjBhB,GAAUA,EAASc,SACrBP,OAAOC,aAAaS,WAAWnB,GACxBD,SAIHa,GAAS,CAAC,SAAU,SAAU,WAAWQ,QAAQR,GAAQ,EAAI,2CACjE,MAAOS,UACPC,QAAQC,MAAMF,IACP,SAECT,OACD,SACHJ,YAAUA,aAEP,SACHA,GAAcA,YAEX,UACHA,IAAeA,SAML,OAATA,EAAgBT,EAAeS,iCAOjCR,WACAG,KAAKC,kBACVJ,EAAMG,KAAKE,WAAWL,GACtBS,OAAOC,aAAaS,WAAWnB,IACxB,sCAGEA,UACFG,KAAKP,WAAaI,mDAjHlBS,OAAOC,eAAiBD,OAAOC,aAAaC,QAAQ,MAAO,MAA+C,OAAvCF,OAAOC,aAAaK,QAAQ,oDAK/FZ,KAAKC,yDASLD,KAAKP,yBAOAK,QACPL,WAAaK,YAAWA,OAAW,sCAGzBA,QACVJ,cAAgBI"}