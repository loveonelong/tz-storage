{"version":3,"file":"tz-storage.min.js","sources":["../src/Storage.js"],"sourcesContent":["class Storage {\r\n  constructor() {\r\n    this._namespace = ''\r\n    this._defaultValue = null\r\n    this._isSupported = this._checkSupported\r\n  }\r\n\r\n  /**\r\n   * check supported getter\r\n   * @readonly\r\n   * @memberof Storage\r\n   */\r\n  get _checkSupported() {\r\n    return window.localStorage && (window.localStorage.setItem('tls', 'ls') , window.localStorage.getItem('tls') === 'ls')\r\n  }\r\n\r\n  get isSupported() {\r\n    return this._checkSupported\r\n  }\r\n\r\n  /**\r\n   * namespace getter\r\n   * @memberof Storage\r\n   * @returns {string}\r\n   */\r\n  get namespace() {\r\n    return this._namespace\r\n  }\r\n\r\n  /**\r\n   * namespace setter\r\n   * @memberof Storage\r\n   */\r\n  set namespace(value) {\r\n    this._namespace = value ? `${value}.` : ''\r\n  }\r\n\r\n  set defaultValue(value) {\r\n    this._defaultValue = value\r\n  }\r\n\r\n  /**\r\n   * set localstorage value\r\n   * @param {string} key \r\n   * @param {string} value \r\n   * @param {number} [expire] expire timestamp, pass 0 to disable expire\r\n   * @returns\r\n   * @memberof Storage\r\n   */\r\n  set(key, value, expire = 0) {\r\n    if (!this._isSupported) return false\r\n    key = this._keyHandle(key)\r\n    value = JSON.stringify({ data: value , expire: expire})\r\n    try {\r\n      window.localStorage.setItem(key, value)\r\n      return true\r\n    } catch (e) {\r\n      console.error(e, `Type Error: value is not supported.`)\r\n      return false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * get localstorage value\r\n   * @param {string} key \r\n   * @param {object} options\r\n   * @param {any} options.defaultValue returned when the value is empty\r\n   * @param {string=[\"string\",\"number\",\"boolean\"]} options.type parse type of the value \r\n   */\r\n  get(key, {defaultValue = this._defaultValue, type} = {}) {\r\n    if (!this._isSupported) return defaultValue\r\n    key = this._keyHandle(key)\r\n    let _value = JSON.parse(window.localStorage.getItem(key))\r\n    if (_value === null) return defaultValue\r\n\r\n    let { data, expire } = _value\r\n    \r\n    let now = new Date().getTime()\r\n    if (expire && expire < now) {\r\n      window.localStorage.removeItem(key)\r\n      return defaultValue\r\n    }\r\n    switch (type) {\r\n      case 'string':\r\n        data = `${data}`\r\n        break\r\n      case 'number':\r\n        data = Number(data)\r\n        break\r\n      case 'boolean':\r\n        data = Boolean(data)\r\n        break\r\n      default:\r\n        break\r\n    }\r\n    \r\n    return data === null ? defaultValue : data\r\n  }\r\n\r\n  /**\r\n   * remove the specified localstorage\r\n   * @param {string} key \r\n   */\r\n  remove(key) {\r\n    if (!this._isSupported) return false\r\n    key = this._keyHandle(key)\r\n    window.localStorage.removeItem(key)\r\n    return true\r\n  }\r\n\r\n  _keyHandle(key) {\r\n    return this._namespace + key\r\n  }\r\n}\r\n\r\nexport default new Storage()\r\n"],"names":["_namespace","_defaultValue","_isSupported","this","_checkSupported","key","value","expire","_keyHandle","JSON","stringify","data","window","localStorage","setItem","e","console","error","defaultValue","type","_value","parse","getItem","now","Date","getTime","removeItem"],"mappings":"0WAmHe,uIAjHNA,WAAa,QACbC,cAAgB,UAChBC,aAAeC,KAAKC,mGA6CvBC,EAAKC,OAAOC,yDAAS,MAClBJ,KAAKD,aAAc,OAAO,EAC/BG,EAAMF,KAAKK,WAAWH,GACtBC,EAAQG,KAAKC,UAAU,CAAEC,KAAML,EAAQC,OAAQA,eAE7CK,OAAOC,aAAaC,QAAQT,EAAKC,IAC1B,EACP,MAAOS,UACPC,QAAQC,MAAMF,0CACP,+BAWPV,gEAAiD,OAA3Ca,aAAAA,aAAef,KAAKF,gBAAekB,IAAAA,SACtChB,KAAKD,aAAc,OAAOgB,EAC/Bb,EAAMF,KAAKK,WAAWH,OAClBe,EAASX,KAAKY,MAAMT,OAAOC,aAAaS,QAAQjB,OACrC,OAAXe,EAAiB,OAAOF,MAEtBP,EAAiBS,EAAjBT,KAAMJ,EAAWa,EAAXb,OAERgB,GAAM,IAAIC,MAAOC,aACjBlB,GAAUA,EAASgB,SACrBX,OAAOC,aAAaa,WAAWrB,GACxBa,SAEDC,OACD,SACHR,YAAUA,aAEP,SACHA,GAAcA,YAEX,UACHA,IAAeA,SAMH,OAATA,EAAgBO,EAAeP,iCAOjCN,WACAF,KAAKD,eACVG,EAAMF,KAAKK,WAAWH,GACtBO,OAAOC,aAAaa,WAAWrB,IACxB,sCAGEA,UACFF,KAAKH,WAAaK,iDAlGlBO,OAAOC,eAAiBD,OAAOC,aAAaC,QAAQ,MAAO,MAA+C,OAAvCF,OAAOC,aAAaS,QAAQ,mDAI/FnB,KAAKC,yDASLD,KAAKH,yBAOAM,QACPN,WAAaM,YAAWA,OAAW,sCAGzBA,QACVL,cAAgBK"}